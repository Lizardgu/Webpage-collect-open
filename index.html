<!DOCTYPE html><html lang="zh-CN"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>网址笔记本（含标签、导入导出）</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#94a3b8;
      --accent:#3b82f6;
      --accent-2:#06b6d4;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
      --max-width:980px;
    }
    html,body{
      height:100%;
      margin:0;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Apple Color Emoji","Segoe UI Emoji";
      background: linear-gradient(180deg,#071024 0%, #052033 60%);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .container{
      max-width:var(--max-width);
      margin:28px auto;
      padding:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);
    }
    header{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:16px;
    }
    .logo{
      width:46px;height:46px;border-radius:10px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      display:flex;align-items:center;justify-content:center;font-weight:700;
      box-shadow: 0 6px 18px rgba(14,108,255,0.12);
      flex:0 0 46px;
    }
    h1{font-size:18px;margin:0;}
    .top-actions{
      margin-left:auto;
      display:flex;
      gap:8px;
      align-items:center;
    }
    button{
      background:var(--glass);
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.03);
      padding:8px 12px;
      border-radius:9px;
      cursor:pointer;
      font-weight:600;
    }
    button.primary{
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      color:white;
      border:none;
      box-shadow: 0 6px 20px rgba(3,105,255,0.18);
    }
    main{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      padding:8px 4px 18px 4px;
    }
    .controls{
      display:flex;gap:8px;align-items:center;margin-bottom:10px;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
      gap:12px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
      border-radius:12px;
      padding:12px;
      display:flex;
      gap:10px;
      align-items:flex-start;
      min-height:68px;
      border:1px solid rgba(255,255,255,0.03);
      cursor: pointer;
      transition: transform .08s ease, box-shadow .08s ease;
    }
    .card:active{ transform: translateY(1px); }
    .favicon{
      width:44px;height:44px;border-radius:8px;background:#0b1b2b;flex:0 0 44px;
      display:flex;align-items:center;justify-content:center;overflow:hidden;
    }
    .favicon img{width:100%;height:100%;object-fit:cover;display:block;}
    .meta{flex:1;min-width:0;}
    .url{
      color:#dbeafe;
      font-weight:700;
      text-decoration:none;
      display:block;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      font-size:14px;
      cursor:text;
    }
    .tags{
      margin-top:6px;display:flex;gap:6px;flex-wrap:wrap;
    }
    .tag{
      background:rgba(255,255,255,0.04);
      color:var(--muted);
      padding:4px 8px;border-radius:999px;font-size:12px;
    }
    .note{
      margin-top:6px;
      background:transparent;
      border:none;
      color:var(--muted);
      font-size:13px;
      width:100%;
      outline:none;
    }
    .note[contenteditable]:empty:before{
      content:attr(data-placeholder);
      color:rgba(148,163,184,0.5);
      pointer-events:none;
    }
    .actions{
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:flex-end;
    }
    .small{
      font-size:12px;padding:6px 8px;border-radius:8px;
      background:rgba(255,255,255,0.02);color:var(--muted);border:1px solid rgba(255,255,255,0.02);
    }
    .delete{
      background:transparent;border:1px dashed rgba(255,255,255,0.03);color:#ffb4b4;
    }
    footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
    /* modal */
    .modal-backdrop{
      position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;padding:20px;z-index:60;
    }
    .modal{
      width:100%;max-width:640px;background:linear-gradient(180deg,#071428,#051226);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 18px 50px rgba(2,6,23,0.7);
    }
    .form-row{display:flex;flex-direction:column;gap:8px;margin-bottom:8px;}
    label{font-size:13px;color:var(--muted);font-weight:600}
    input[type="url"], input[type="text"], input[type="file"]{
      padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#e6eef8;outline:none;
    }
    .hint{font-size:12px;color:rgba(148,163,184,0.75)}
    .tag-chooser{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .tag-chooser button{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);color:var(--muted);border:1px solid rgba(255,255,255,0.03)}
    .label-inline{display:flex;gap:8px;align-items:center}
    @media (max-width:560px){
      .container{margin:12px;padding:12px;border-radius:10px}
      header{gap:8px}
      .logo{width:40px;height:40px}
      .top-actions{gap:6px}
    }
  </style>
<script src="https://puc.poecdn.net/authenticated_preview_page/syncedState.bd4eeeb8e8e02052ee92.js"></script></head>
<body>
  <div class="container" id="app">
    <header>
      <div class="logo">笔记</div>
      <div>
        <h1>网址笔记本</h1>
        <div class="hint">添加时可指定标签；一键打开可按标签打开</div>
      </div>
      <div class="top-actions">
        <button id="addBtn">添加</button>
        <button id="exportBtn">导出</button>
        <label style="display:inline-block;margin:0">
          <input id="importFile" type="file" accept="application/json" style="display:none">
          <button id="importBtn">导入</button>
        </label>
        <button class="primary" id="openAllBtn">一键打开所有</button>
      </div>
    </header>

    <main>
      <div class="controls">
        <div class="label-inline">
          <label style="color:var(--muted);font-weight:700;margin-right:8px">筛选标签：</label>
          <select id="filterTag">
            <option value="__all__">全部</option>
            <option value="__untagged__">无标签</option>
          </select>
        </div>
        <div style="margin-left:auto;color:var(--muted)">条目会保存在本地浏览器</div>
      </div>

      <div class="grid" id="list"></div>
      <footer>双击页面任意空白处或点击“添加”来加入网址。标签用逗号分隔可添加多个。</footer>
    </main>
  </div>

  <!-- 添加/编辑 模态 -->
  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle" style="margin:0 0 8px 0;color:#e6eef8">添加网址</h3>
      <div class="form-row">
        <label for="urlInput">网址（URL）</label>
        <input id="urlInput" type="url" placeholder=" ">
      </div>
      <div class="form-row">
        <label for="tagsInput">标签（逗号分隔，可选）</label>
        <input id="tagsInput" type="text" placeholder=" ">
        <div class="hint">输入新标签后按回车或保存即可；也可点击下方已有标签快速添加。</div>
        <div class="tag-chooser" id="tagChooser"></div>
      </div>
      <div class="form-row">
        <label for="noteInput">备注（可选）</label>
        <input id="noteInput" type="text" placeholder=" ">
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
        <button id="cancelBtn">取消</button>
        <button class="primary" id="saveBtn">保存并添加</button>
      </div>
    </div>
  </div>

  <!-- open-by-tag 模态 -->
  <div class="modal-backdrop" id="openTagModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="openTagTitle">
      <h3 id="openTagTitle" style="margin:0 0 8px 0;color:#e6eef8">选择要打开的标签</h3>
      <div class="form-row" id="openTagList" style="max-height:320px;overflow:auto"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
        <button id="openTagCancel">取消</button>
        <button class="primary" id="openTagConfirm">打开选中标签</button>
      </div>
    </div>
  </div>

  <script>
    // 简单工具
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const storageKey = 'url-notebook-v1-tags';

    // state
    let items = []; // 每项 {url, note, favicon, tags: []}
    // DOM
    const listEl = $('#list');
    const modal = $('#modal');
    const openTagModal = $('#openTagModal');
    const urlInput = $('#urlInput');
    const tagsInput = $('#tagsInput');
    const noteInput = $('#noteInput');
    const addBtn = $('#addBtn');
    const openAllBtn = $('#openAllBtn');
    const saveBtn = $('#saveBtn');
    const cancelBtn = $('#cancelBtn');
    const exportBtn = $('#exportBtn');
    const importBtn = $('#importBtn');
    const importFile = $('#importFile');
    const tagChooser = $('#tagChooser');
    const filterTag = $('#filterTag');
    const openTagList = $('#openTagList');
    const openTagCancel = $('#openTagCancel');
    const openTagConfirm = $('#openTagConfirm');

    function load(){
      try{
        const raw = localStorage.getItem(storageKey);
        items = raw ? JSON.parse(raw) : [];
      }catch(e){ items = []; }
    }
    function save(){
      localStorage.setItem(storageKey, JSON.stringify(items));
    }

    function buildFaviconUrl(url){
      try{
        const u = new URL(url);
        return u.origin + '/favicon.ico';
      }catch(e){ return null; }
    }
    function placeholderFavicon(text){
      const bg = '1f2937';
      const fg = 'e2e8f0';
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'>
        <rect width='100%' height='100%' fill='#${bg}' rx='8'/>
        <text x='50%' y='54%' font-family='Arial,Helvetica,sans-serif' font-size='28' fill='#${fg}' text-anchor='middle' dominant-baseline='middle'>${text}</text>
      </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }
    function domainInitial(url){
      try{
        const u = new URL(url);
        const host = u.hostname.replace('www.','');
        return (host[0]||'').toUpperCase();
      }catch(e){ return '?'; }
    }

    // 标签相关
    function allTags(){
      const s = new Set();
      items.forEach(it => {
        (it.tags || []).forEach(t => { if(t && t.trim()) s.add(t.trim()); });
      });
      return Array.from(s).sort((a,b)=> a.localeCompare(b));
    }

    function setFilterOptions(){
      const cur = filterTag.value;
      filterTag.innerHTML = '';
      const optAll = document.createElement('option');
      optAll.value = '__all__';
      optAll.textContent = '全部';
      filterTag.appendChild(optAll);
      const optUntag = document.createElement('option');
      optUntag.value = '__untagged__';
      optUntag.textContent = '无标签';
      filterTag.appendChild(optUntag);
      allTags().forEach(t => {
        const o = document.createElement('option');
        o.value = t;
        o.textContent = t;
        filterTag.appendChild(o);
      });
      // try restore
      if([].concat('__all__','__untagged__', ...allTags()).includes(cur)){
        filterTag.value = cur;
      }
    }

    // 渲染列表（会根据筛选标签过滤）
    function render(){
      setFilterOptions();
      listEl.innerHTML = '';
      const filter = filterTag.value;
      items.forEach((it, idx) => {
        // apply filter
        if(filter === '__untagged__' && (it.tags && it.tags.length)) return;
        if(filter !== '__all__' && filter !== '__untagged__'){
          if(!(it.tags && it.tags.includes(filter))) return;
        }

        const card = document.createElement('div');
        card.className = 'card';
        card.addEventListener('click', (e) => {
          const target = e.target;
          if(target.closest('button') || target.closest('.note') || target.closest('a')) return;
          window.open(it.url, '_blank', 'noopener');
        });

        const favWrap = document.createElement('div');
        favWrap.className = 'favicon';
        const img = document.createElement('img');
        img.alt = '';
        img.loading = 'lazy';
        img.src = it.favicon || buildFaviconUrl(it.url) || placeholderFavicon(domainInitial(it.url));
        img.onerror = function(){
          const trial = buildFaviconUrl(it.url);
          if(trial && trial !== img.src){
            img.src = trial;
            return;
          }
          img.src = placeholderFavicon(domainInitial(it.url));
        };
        favWrap.appendChild(img);

        const meta = document.createElement('div');
        meta.className = 'meta';
        const a = document.createElement('a');
        a.className = 'url';
        a.href = it.url;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.textContent = it.url;

        const tagsWrap = document.createElement('div');
        tagsWrap.className = 'tags';
        (it.tags || []).forEach(t => {
          const el = document.createElement('span');
          el.className = 'tag';
          el.textContent = t;
          tagsWrap.appendChild(el);
        });

        const note = document.createElement('div');
        note.className = 'note';
        note.contentEditable = 'true';
        note.dataset.placeholder = '点击编辑备注（双击也可），同时可编辑标签（输入逗号分隔）';
        note.innerText = it.note || '';
        note.addEventListener('input',()=>{
          items[idx].note = note.innerText.trim();
          save();
        });
        // 双击备注可快速编辑标签：在备注行输入 "tags: a,b" 时可解析（方便）
        note.addEventListener('blur',()=>{
          // try parse tags from note line if user wrote "tags: a,b"
          const m = note.innerText.match(/tags\s*[:：]\s*(.+)$/i);
          if(m){
            const txt = m[1].trim();
            const tags = parseTags(txt);
            items[idx].tags = tags;
            // remove the tags: ... text from note
            items[idx].note = note.innerText.replace(m[0],'').trim();
            save();
            render();
          }
        });

        meta.appendChild(a);
        if((it.tags || []).length) meta.appendChild(tagsWrap);
        meta.appendChild(note);

        const actions = document.createElement('div');
        actions.className = 'actions';
        const openBtn = document.createElement('button');
        openBtn.className = 'small';
        openBtn.textContent = '打开';
        openBtn.onclick = (ev) => { ev.stopPropagation(); window.open(it.url, '_blank', 'noopener'); };
        const editBtn = document.createElement('button');
        editBtn.className = 'small';
        editBtn.textContent = '编辑';
        editBtn.onclick = (ev) => { ev.stopPropagation(); openEditModal(idx); };
        const delBtn = document.createElement('button');
        delBtn.className = 'small delete';
        delBtn.textContent = '删除';
        delBtn.onclick = (ev) => {
          ev.stopPropagation();
          if(confirm('确定删除这条网址吗？')){ items.splice(idx,1); save(); render(); }
        };
        actions.appendChild(openBtn);
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        card.appendChild(favWrap);
        card.appendChild(meta);
        card.appendChild(actions);
        listEl.appendChild(card);
      });
    }

    function normalizeUrl(raw){
      if(!raw) return null;
      raw = raw.trim();
      if(!/^https?:\/\//i.test(raw)) raw = 'https://' + raw;
      try{ const u = new URL(raw); return u.href; }catch(e){ return null; }
    }

    function parseTags(raw){
      if(!raw) return [];
      return raw.split(',').map(s=>s.trim()).filter(Boolean).map(s=>s.replace(/\s+/g,' '));
    }

    // 打开添加模态（用于新建），支持预填 url
    function openModal(prefillUrl){
      urlInput.value = prefillUrl || '';
      tagsInput.value = '';
      noteInput.value = '';
      renderTagChooser();
      modal.style.display = 'flex';
      setTimeout(()=> urlInput.focus(),50);
    }
    function closeModal(){ modal.style.display = 'none'; }

    function openEditModal(idx){
      const it = items[idx];
      urlInput.value = it.url;
      tagsInput.value = (it.tags || []).join(', ');
      noteInput.value = it.note || '';
      renderTagChooser();
      modal.style.display = 'flex';
      // modify save behavior: replace existing rather than add new
      saveBtn.dataset.editIndex = idx;
      setTimeout(()=> urlInput.focus(),50);
    }

    function clearEditFlag(){ delete saveBtn.dataset.editIndex; }

    async function addOrSaveItem(rawUrl, tagsRaw, note){
      const url = normalizeUrl(rawUrl);
      if(!url){ alert('无效的网址，请输入正确的 URL 或域名'); return false; }
      const tags = parseTags(tagsRaw);
      const fav = buildFaviconUrl(url);
      const editIndex = saveBtn.dataset.editIndex;
      if(typeof editIndex !== 'undefined'){
        const i = Number(editIndex);
        items[i] = { url, note: note?note.trim():'', favicon: fav, tags };
        clearEditFlag();
      }else{
        items.unshift({ url, note: note?note.trim():'', favicon: fav, tags });
      }
      save();
      render();
      return true;
    }

    // render tag chooser (buttons for existing tags)
    function renderTagChooser(){
      tagChooser.innerHTML = '';
      const tags = allTags();
      tags.forEach(t => {
        const b = document.createElement('button');
        b.type = 'button';
        b.textContent = t;
        b.onclick = ()=> {
          const cur = parseTags(tagsInput.value);
          if(!cur.includes(t)){
            cur.push(t);
            tagsInput.value = cur.join(', ');
          }
        };
        tagChooser.appendChild(b);
      });
    }

    // openAll with tag selection modal
    function openAll(){
      // build options
      openTagList.innerHTML = '';
      const container = document.createElement('div');
      container.style.display = 'flex';
      container.style.flexDirection = 'column';
      container.style.gap = '8px';
      const optAll = document.createElement('label');
      optAll.innerHTML = `<input type="radio" name="opentag" value="__all__" checked /> 全部`;
      container.appendChild(optAll);
      const optUntag = document.createElement('label');
      optUntag.innerHTML = `<input type="radio" name="opentag" value="__untagged__" /> 无标签`;
      container.appendChild(optUntag);
      allTags().forEach(t=>{
        const lab = document.createElement('label');
        lab.innerHTML = `<input type="radio" name="opentag" value="${escapeHtmlAttr(t)}" /> ${t}`;
        container.appendChild(lab);
      });
      openTagList.appendChild(container);
      openTagModal.style.display = 'flex';
    }

    function escapeHtmlAttr(s){
      return String(s).replace(/"/g,'&quot;').replace(/'/g,'&#39;');
    }

    function confirmOpenTag(){
      const sel = openTagList.querySelector('input[name="opentag"]:checked');
      if(!sel) return;
      const val = sel.value;
      openTagModal.style.display = 'none';
      let toOpen = [];
      if(val === '__all__'){
        toOpen = items.slice();
      }else if(val === '__untagged__'){
        toOpen = items.filter(i => !(i.tags && i.tags.length));
      }else{
        toOpen = items.filter(i => i.tags && i.tags.includes(val));
      }
      if(toOpen.length === 0){ alert('没有匹配的条目要打开'); return; }
      if(toOpen.length > 50 && !confirm(`将尝试打开 ${toOpen.length} 个网址，可能会被浏览器拦截。继续？`)) return;
      toOpen.forEach(it => window.open(it.url, '_blank', 'noopener'));
    }

    // export / import
    function exportData(){
      const dataStr = JSON.stringify(items, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const now = new Date();
      const ts = now.toISOString().replace(/[:.]/g,'-');
      a.href = url;
      a.download = `url-notebook-export-${ts}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function handleImportFile(file){
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try{
          const parsed = JSON.parse(e.target.result);
          if(!Array.isArray(parsed)){ alert('导入文件应为数组格式的 JSON'); return; }
          const ok = parsed.every(it => it && typeof it.url === 'string');
          if(!ok){ alert('导入的数据缺少 url 字段'); return; }
          const mode = confirm('点击“确定”合并导入（保留原有并添加导入项），点击“取消”覆盖现有数据。') ? 'merge' : 'replace';
          if(mode === 'replace'){
            items = parsed.map(normalizeImportedItem);
          }else{
            const existSet = new Set(items.map(i => i.url));
            const toAdd = parsed.map(normalizeImportedItem).filter(i => !existSet.has(i.url));
            items = items.concat(toAdd);
          }
          save();
          render();
          alert('导入完成');
        }catch(err){
          console.error(err);
          alert('解析导入文件出错：' + err.message);
        }
      };
      reader.onerror = ()=> alert('读取文件失败');
      reader.readAsText(file,'utf-8');
    }

    function normalizeImportedItem(it){
      const url = normalizeUrl(it.url) || it.url;
      return {
        url,
        note: it.note ? String(it.note) : '',
        favicon: it.favicon ? String(it.favicon) : buildFaviconUrl(url),
        tags: Array.isArray(it.tags) ? it.tags.map(t=>String(t)) : parseTags(it.tags || '')
      };
    }

    // events
    addBtn.addEventListener('click', ()=> openModal());
    cancelBtn.addEventListener('click', ()=> { closeModal(); clearEditFlag(); });
    saveBtn.addEventListener('click', async ()=>{
      const ok = await addOrSaveItem(urlInput.value, tagsInput.value, noteInput.value);
      if(ok){ closeModal(); clearEditFlag(); }
    });

    openAllBtn.addEventListener('click', openAll);
    openTagCancel.addEventListener('click', ()=> openTagModal.style.display = 'none');
    openTagConfirm.addEventListener('click', confirmOpenTag);

    exportBtn.addEventListener('click', exportData);
    importBtn.addEventListener('click', ()=> importFile.click());
    importFile.addEventListener('change', (e)=>{
      const f = e.target.files && e.target.files[0];
      if(f) handleImportFile(f);
      importFile.value = '';
    });

    // filter change
    filterTag.addEventListener('change', render);

    // double-click blank to add
    document.getElementById('app').addEventListener('dblclick', (e)=>{
      const path = e.composedPath ? e.composedPath() : (e.path || []);
      for(const node of path){
        if(node && node.classList && node.classList.contains && node.classList.contains('card')) return;
        if(node && node.id === 'modal') return;
      }
      openModal();
    });

    // click outside modal closes
    modal.addEventListener('click', (e)=> { if(e.target === modal){ closeModal(); clearEditFlag(); } });
    openTagModal.addEventListener('click', (e)=> { if(e.target === openTagModal) openTagModal.style.display = 'none'; });

    // keyboard shortcuts in modal
    modal.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' && (document.activeElement === urlInput || document.activeElement === tagsInput || document.activeElement === noteInput)){
        e.preventDefault(); saveBtn.click();
      }else if(e.key === 'Escape'){
        closeModal(); clearEditFlag();
      }
    });

    // paste quick add
    window.addEventListener('paste',(e)=>{
      const pasted = (e.clipboardData || window.clipboardData).getData('text');
      if(pasted && /[:.]/.test(pasted) && !document.activeElement.matches('input,textarea,[contenteditable="true"]')){
        openModal(pasted);
      }
    });

    // expose for console
    window._urlNotebook = {
      getItems: ()=> JSON.parse(JSON.stringify(items)),
      import: (arr)=>{ if(Array.isArray(arr)){ items = arr.map(normalizeImportedItem); save(); render(); } },
      clear: ()=>{ if(confirm('确定清空所有记录？')){ items = []; save(); render(); } }
    };

    // init
    load();
    render();
  </script>


</body></html>